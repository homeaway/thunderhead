!function(e,t,n){"use strict";var r=function(r){this.Model=t.Model.extend({initialize:function(t,r){var i=this.get("defaultDate"),s=e.extend(!0,[],this.get("calendar"));n.bindAll(this,"formatDate","getDefaultDates","resolveDates","setDataBounds","reverseFormatDate","getReservationsById"),s=e.merge(s,this.getDefaultDates()),this.set("calendar",s),i===""?this.setDataBounds(new Date):this.setDataBounds(this.reverseFormatDate(i))},setDataBounds:function(e){var t=new Date(e.getTime()),n=new Date(e.getTime()),r=new Date(e.setMonth(e.getMonth()+12)),i=new Date(t.setMonth(t.getMonth()-12));return this.set({endDate:this.formatDate(r),startDate:this.formatDate(i),defaultDate:this.formatDate(n)}),!1},defaults:{calendar:[]},parse:function(t){return t.calendar=this.resolveDates(t.calendar,t.reservations),t.calendar=e.merge(this.getDefaultDates(),t.calendar),t},resolveDates:function(t,n){function o(e,t){return{date:e.date,reservationId:e.reservationId,duration:(e.duration!=="undefined"?e.duration:undefined)||(t.checkinDate===e.date?"pm":undefined)||(t.checkoutDate===e.date?"am":"full"),status:typeof t!="undefined"?typeof t.status!="undefined"?t.status.toLowerCase():"":"",guestFirstName:typeof t!="undefined"?t.guestFirstName:undefined,guestLastName:typeof t!="undefined"?t.guestLastName:undefined,checkinTime:typeof t!="undefined"?t.checkinTime:undefined,checkoutTime:typeof t!="undefined"?t.checkoutTime:undefined}}var r=[],i,s;for(i in t){s=typeof n!="undefined"?n[t[i].reservationId]:undefined;if(typeof t[i].startDate!="undefined"&&t[i].startDate!==""&&typeof t[i].endDate!="undefined"&&t[i].endDate!==""){var u=t[i].startDate,a=u.split("-"),f=t[i].endDate,l=f.split("-"),c=new Date(a[0],parseInt(a[1],10)-1,a[2]),h=new Date(l[0],parseInt(l[1],10)-1,l[2]),p=c,d,v;r.push(o({date:u,duration:"pm",reservationId:t[i].reservationId},s)),d=(h-c)/864e5,p=c;for(v=1;v<d;v++)p.setDate(p.getDate()+1),r.push(o({date:this.formatDate(p),duration:"full",reservationId:t[i].reservationId},s));r.push(o({date:f,duration:"am",reservationId:t[i].reservationId},s)),delete n[t[i].reservationId]}else r.push(o(e.extend(!0,{date:i},t[i]),s))}for(i in n)r.push(o({date:n[i].checkoutDate,reservationId:i},n[i]));return r},getDefaultDates:function(){return this.resolveDates(e.extend(!0,{},this.get("defaultCalendar")),e.extend(!0,{},this.get("defaultCalendarEvents")))},getReservationsById:function(t){return n.where(e.extend(!0,[],this.get("calendar")),{reservationId:t})},formatDate:function(e){var t=e.getDate().toString(),n=(e.getMonth()+1).toString();return e.getFullYear().toString()+"-"+(n[1]?n:"0"+n[0])+"-"+(t[1]?t:"0"+t[0])},reverseFormatDate:function(e){var t=e.split("-");return new Date(parseInt(t[0],10),parseInt(t[1],10)-1,parseInt(t[2],10))},url:function(){return this.get("url")+this.get("propertyDruid")+"?startDate="+this.get("startDate")+"&endDate="+this.get("endDate")}}),e.datepicker._modifiedXYZ||(e.datepicker._updateDatepicker_original=e.datepicker._updateDatepicker,e.datepicker._updateDatepicker=function(t){e.datepicker._updateDatepicker_original(t);var n=this._get(t,"afterShow");n&&n.apply(t.input?t.input[0]:null)},e.datepicker._modifiedXYZ=!0),this.View=t.View.extend({initialize:function(r){var i=this;n.bindAll(this,"fetchData");var s=function(t){var n=r.clicked[t];r.clicked[t]=function(r,s){e(i.el).trigger(t,[r,s]),n.call(this,r,s)}};for(var o in r.clicked)s(o);e.extend(!0,this,{clicked:r.clicked}),e.extend(!0,this,{hovered:r.hovered}),e.extend(!0,this,{error:r.error}),this.endCalendar=r.endCalendar,this.hoverClass=r.hoverClass,this.hoverClassStart=r.hoverClassStart,this.hoverClassEnd=r.hoverClassEnd,this.fetching=r.fetch,this.currentElement=undefined,typeof t.Layout=="undefined"?(n.bindAll(this,"afterRender"),this.model.on("change",this.afterRender,this)):this.model.on("change",this.render,this),this.model.on("error",function(t){e(i.el).trigger("error",t),i.error(t)}),this.model.on("change:startDate",function(){i.fetchData(r.fetch)}),this.fetchData(r.fetch)},fetchData:function(e){var t=this;return this.fetching=e,this.model.trigger("change"),this.model.get("propertyDruid")!==""&&this.fetching&&this.model.fetch({success:function(){t.fetching=!1,t.model.trigger("change")},error:function(){t.fetching=!1,t.model.trigger("change")}}),!1},afterRender:function(){var t=e.extend(!0,[],this.model.get("calendar")),n=this,r=e.extend(!0,{},this.model.get("styles")),i=this.model.get("defaultDate"),s=this.model.get("locale"),o=1,u,a,f,l,c;if(s!=="en_US"||s!=="pt_BR")o=0;return i=this.model.reverseFormatDate(i),e(this.el).datepicker("destroy").datepicker({defaultDate:i,firstDay:o,numberOfMonths:this.model.get("numberOfMonths"),beforeShowDay:function(e){var r="",i,s;e=n.model.formatDate(e);for(s=t.length-1;s>-1;s--)t[s].date===e&&(r+=" "+t[s].duration+"-"+t[s].status.toLowerCase()+" X"+t[s].reservationId+"X");return typeof n.endCalendar!="undefined"&&(i=n.model.reverseFormatDate(e),i<f&&i>a||i<a&&i>c||typeof a!="undefined"&&typeof f!="undefined"&&a.toString()===i.toString()&&f.toString()===a.toString()||typeof a!="undefined"&&typeof c!="undefined"&&c<a&&a.toString()===i.toString()?r+=n.hoverClass:typeof a!="undefined"&&a.toString()===i.toString()||typeof c!="undefined"&&c.toString()===i.toString()?r+=n.hoverClassStart:typeof f!="undefined"&&f.toString()===i.toString()&&(r+=n.hoverClassEnd)),[!0,r,""]},onChangeMonthYear:function(e,t,r){if(this.fetching){var i=n.model.get("startDate"),s=i.split("-"),o=new Date(parseInt(s[0],10),parseInt(s[1],10)-1,parseInt(s[2],10)),u=n.model.get("endDate"),a=u.split("-"),f=new Date(parseInt(a[0],10),parseInt(a[1],10)-1,parseInt(a[2],10)),l=n.model.get("numberOfMonths"),c=l,h=0,p=0,d=new Date(e,t-1,1),v,m,g;if(Object.prototype.toString.call(l)==="[object Array]"){c=0;for(m=0;m<l.length;m++)c+=l[m]}h=(d.getFullYear()-o.getFullYear())*12,h-=o.getMonth()+1,h+=d.getMonth(),v=new Date(d.setMonth(d.getMonth()+c-2)),p=(f.getFullYear()-v.getFullYear())*12,p-=v.getMonth()+1,p+=f.getMonth(),(p<1||h<1)&&n.model.setDataBounds(new Date(e,t-1,1))}return!1},afterShow:function(){function t(e){return e.indexOf("reserve")!==-1?"reserve":e.indexOf("hold")!==-1?"hold":e.indexOf("delete")!==-1?"delete":e.indexOf("cancel")!==-1?"cancel":e.indexOf("unavailable")!==-1?"unavailable":e.indexOf("inquiry")!==-1?"inquiry":""}function r(t,r,i){if(i!=="inquiry"){var s,o,u,a,f;o=e(n.el).find(".X"+t+"X");if(r)for(f=0;f<o.length;f++)s=e(o[f]),a=s.attr("class").split("X"),a[1]===t?(a[0]=a[0].replace("full-"+i,"full-"+i+"-hover"),a[0]=a[0].replace("am-"+i,"am-"+i+"-hover"),a[0]=a[0].replace("pm-"+i,"pm-"+i+"-hover")):(a[2]=a[2].replace("full-"+i,"full-"+i+"-hover"),a[2]=a[2].replace("am-"+i,"am-"+i+"-hover"),a[2]=a[2].replace("pm-"+i,"pm-"+i+"-hover")),s.attr("class",a.join("X"));else for(f=0;f<o.length;f++)s=e(o[f]).unbind("mousemove"),u=s.attr("class"),u=u.replace(/-hover/g,""),s.attr("class",u)}}e(".ui-state-default").hover(function(i){var s=e(this).parent().attr("class"),o=s.split("X"),a,f,l,h;s.indexOf("X")!==-1&&(a=o[1],o.length-1>3?e(this).unbind("mousemove").mousemove(function(i){var s=e(this).parent().offset(),l=i.pageX-s.left,c=i.pageY-s.top,h=e(this).parent().width()/2;r(a,!1,f),r(o[3],!1,f),l<h&&c<h?(f=t(o[0]),a=o[1],f==="inquiry"&&(f=o[2],a=o[3])):(f=t(o[2]),a=o[3],f==="inquiry"&&(f=o[0],a=o[1])),u!==a&&(n.currentElement=e(this),n.hovered.on(e(this),n.model.getReservationsById(a))),u=a,f=t(f),r(a,!0,f)}):(u=a,f=t(s),r(a,!0,f)),n.currentElement=e(this),n.hovered.on(e(this),n.model.getReservationsById(a))),l=e(this).parent().attr("onclick").split(","),h=n.model.reverseFormatDate(l[2]+"-"+(parseInt(l[1],10)+1)+"-"+e(this).html());if(typeof c=="undefined"||c.toString()!==h.toString())c=h,e(n.el).datepicker("refresh")},function(t){var i=e(this).parent().attr("class"),s=i.split("X"),o=s[1];s.length-1>3&&(r(s[3],!1,""),n.currentElement=e(this),n.hovered.off(e(this),n.model.getReservationsById(o))),typeof o!="undefined"&&(r(o,!1,""),n.currentElement=e(this),n.hovered.off(e(this),n.model.getReservationsById(o)))})},onSelect:function(r,i){var s=r.split("/"),o=s[2]+"-"+s[0]+"-"+s[1],f,l;i.inline=!1;for(f=0;f<t.length;f++)t[f].date===o&&t[f].reservationId===u&&(typeof n.clicked[t[f].status.toLowerCase()]!="undefined"?n.clicked[t[f].status.toLowerCase()](n.currentElement,t[f]):e(n.el).trigger(t[f].status.toLowerCase(),n.currentElement,t[f]));l=n.model.reverseFormatDate(o),(typeof a=="undefined"||l.toString()!==a.toString())&&e(n.el).trigger("changed"),a=l},onClose:function(t,r){if(typeof n.endCalendar!="undefined"){c=undefined,e(n.el).datepicker("refresh").trigger("blur");if(f<a||typeof f=="undefined")f=a,e(n.endCalendar).datepicker("setDate",f),e(n.endCalendar).trigger("changed")}}}),typeof this.endCalendar!="undefined"&&e(this.endCalendar).datepicker("destroy").datepicker({defaultDate:i,firstDay:o,numberOfMonths:this.model.get("numberOfMonths"),beforeShowDay:function(e){var r="",i,s;e=n.model.formatDate(e);for(s=t.length-1;s>-1;s--)t[s].date===e&&(r+=" "+t[s].duration+"-"+t[s].status.toLowerCase()+" X"+t[s].reservationId+"X");i=n.model.reverseFormatDate(e);if(a<l&&a<i&&i<l||typeof f!="undefined"&&i>a&&i<f||typeof a!="undefined"&&typeof f!="undefined"&&a.toString()===i.toString()&&f.toString()===a.toString())r+=n.hoverClass;else if(typeof a!="undefined"&&a.toString()===i.toString())r+=n.hoverClassStart;else if(typeof f!="undefined"&&i.toString()===f.toString()||typeof l!="undefined"&&i.toString()===l.toString())r+=n.hoverClassEnd;return[!0,r,""]},onChangeMonthYear:function(e,t,r){if(this.fetching){var i=n.model.get("startDate"),s=i.split("-"),o=new Date(parseInt(s[0],10),parseInt(s[1],10)-1,parseInt(s[2],10)),u=n.model.get("endDate"),a=u.split("-"),f=new Date(parseInt(a[0],10),parseInt(a[1],10)-1,parseInt(a[2],10)),l=n.model.get("numberOfMonths"),c=l,h=0,p=0,d=new Date(e,t-1,1),v,m,g;if(Object.prototype.toString.call(l)==="[object Array]"){c=0;for(m=0;m<l.length;m++)c+=l[m]}h=(d.getFullYear()-o.getFullYear())*12,h-=o.getMonth()+1,h+=d.getMonth(),v=new Date(d.setMonth(d.getMonth()+c-2)),p=(f.getFullYear()-v.getFullYear())*12,p-=v.getMonth()+1,p+=f.getMonth(),(p<1||h<1)&&n.model.setDataBounds(new Date(e,t-1,1))}return!1},afterShow:function(){function t(e){return e.indexOf("reserve")!==-1?"reserve":e.indexOf("hold")!==-1?"hold":e.indexOf("delete")!==-1?"delete":e.indexOf("cancel")!==-1?"cancel":e.indexOf("unavailable")!==-1?"unavailable":e.indexOf("inquiry")!==-1?"inquiry":""}function r(t,r,i){if(i!=="inquiry"){var s,o,u,a,f;o=e(n.el).find(".X"+t+"X");if(r)for(f=0;f<o.length;f++)s=e(o[f]),a=s.attr("class").split("X"),a[1]===t?(a[0]=a[0].replace("full-"+i,"full-"+i+"-hover"),a[0]=a[0].replace("am-"+i,"am-"+i+"-hover"),a[0]=a[0].replace("pm-"+i,"pm-"+i+"-hover")):(a[2]=a[2].replace("full-"+i,"full-"+i+"-hover"),a[2]=a[2].replace("am-"+i,"am-"+i+"-hover"),a[2]=a[2].replace("pm-"+i,"pm-"+i+"-hover")),s.attr("class",a.join("X"));else for(f=0;f<o.length;f++)s=e(o[f]).unbind("mousemove"),u=s.attr("class"),u=u.replace(/-hover/g,""),s.attr("class",u)}}e(".ui-state-default").hover(function(i){var s=e(this).parent().attr("class"),o=s.split("X"),a,f,c,h;s.indexOf("X")!==-1&&(a=o[1],o.length-1>3?e(this).unbind("mousemove").mousemove(function(i){var s=e(this).parent().offset(),l=i.pageX-s.left,c=i.pageY-s.top,h=e(this).parent().width()/2;r(a,!1,f),r(o[3],!1,f),l<h&&c<h?(f=t(o[0]),a=o[1],f==="inquiry"&&(f=o[2],a=o[3])):(f=t(o[2]),a=o[3],f==="inquiry"&&(f=o[0],a=o[1])),u!==a&&(n.currentElement=e(this),n.hovered.on(e(this),n.model.getReservationsById(a))),u=a,f=t(f),r(a,!0,f)}):(u=a,f=t(s),r(a,!0,f)),n.currentElement=e(this),n.hovered.on(e(this),n.model.getReservationsById(a))),c=e(this).parent().attr("onclick").split(","),h=n.model.reverseFormatDate(c[2]+"-"+(parseInt(c[1],10)+1)+"-"+e(this).html());if(typeof l=="undefined"||l.toString()!==h.toString())l=h,e(n.endCalendar).datepicker("refresh")},function(t){var i=e(this).parent().attr("class"),s=i.split("X"),o=s[1];s.length-1>3&&(r(s[3],!1,""),n.currentElement=e(this),n.hovered.off(e(this),n.model.getReservationsById(o))),typeof o!="undefined"&&(r(o,!1,""),n.currentElement=e(this),n.hovered.off(e(this),n.model.getReservationsById(o)))})},onSelect:function(r,i){var s=r.split("/"),o=s[2]+"-"+s[0]+"-"+s[1],a,l;i.inline=!1;for(a=0;a<t.length;a++)t[a].date===o&&t[a].reservationId===u&&(typeof n.clicked[t[a].status.toLowerCase()]!="undefined"?n.clicked[t[a].status.toLowerCase()](n.currentElement,t[a]):e(n.el).trigger(t[a].status.toLowerCase(),n.currentElement,t[a]));l=n.model.reverseFormatDate(o),(typeof f=="undefined"||l.toString()!==f.toString())&&e(n.endCalendar).trigger("changed"),f=l},onClose:function(t,r){l=undefined,e(n.endCalendar).datepicker("refresh").trigger("blur");if(typeof a=="undefined"||a>f)a=f,e(n.el).datepicker("setDate",a),e(n.el).trigger("changed")}}),e(this.el).append('<div class="calendar-loading" style="width: '+e(this.el).width()+"px; height: "+e(this.el).height()+"px; display:"+(this.fetching?"block":"none")+';"></div>'),this}}),r=e.extend(!0,{},e.fn.calendar.defaults,r),this.model=new this.Model({defaultDate:r.defaultDate,numberOfMonths:r.numberOfMonths,propertyDruid:r.propertyDruid,defaultCalendar:r.calendar,defaultCalendarEvents:r.reservations,url:r.url,locale:r.locale}),this.view=new this.View({el:r.el,model:this.model,clicked:r.clicked,error:r.error,fetch:r.fetch,hovered:r.hovered,endCalendar:r.endCalendar,hoverClass:r.hoverClass,hoverClassStart:r.hoverClassStart,hoverClassEnd:r.hoverClassEnd})},i=e.fn.calendar;e.fn.calendar=function(t){return this.each(function(){var n=e(this),i=n.data("calendar"),s=typeof t=="object"&&t;s||(s={}),s.el=n,i||n.data("calendar",i=new r(s)),typeof t=="string"&&i[t]()})},e.fn.calendar.Constructor=r,e.fn.calendar.noConflict=function(){return e.fn.calendar=i,this},e.fn.calendar.defaults={endCalendar:undefined,hoverClass:"",hoverClassStart:"",hoverClassEnd:"",locale:"en_US",defaultDate:"",endDate:"",startDate:"",propertyDruid:"",numberOfMonths:1,fetch:!0,calendar:{},reservations:{},clicked:{inquiry:function(e,t){},unavailable:function(e,t){},hold:function(e,t){},reserve:function(e,t){},"delete":function(e,t){}},hovered:{on:function(e,t){},off:function(e,t){}},error:function(e){},url:"/hai/availabilityCalendar/"}}(window.jQuery,window.Backbone,window._);